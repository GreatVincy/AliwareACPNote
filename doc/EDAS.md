# 【产品介绍】【功能与特点】【常见问题】

# 概念

1. 解释: 企业级分布式应用服务
2. 定位: 分布式服务框架

# 组件

1. 服务治理&数据化运营

  - 链路跟踪
  - 服务限流
  - 服务降级依赖管理
  - 常态化压测
  - 容器管理

2. 高性能PRC服务框架

  - 服务发现
  - 服务路由
  - 服务调用
  - 服务监控
  - 服务安全

3. 应用平台管理

  - Java容器
  - 应用管理
  - 弹性伸缩
  - 基础监控
  - 报警通知
  - 日志管理

# 功能

> EDAS涵盖了应用生命周期管理、服务运维等众多功能

1. 全面兼容ApacheTomcat的EDASContainer应用容器
2. 以应用为中心的中间件PaaS平台

  - 应用基本管理和运维(创建、部署、启动、停止、扩容、缩容、下线)
  - 弹性伸缩(支持手动和自动扩容与缩容，能通过对CPU、内存、负载的监控自动实现秒级扩容与缩容)
  - 主子账户体系(用户资源分配)
  - 角色与权限控制(不同账号分配不同的角色和权限)

3. 丰富的分布式服务

  - 分布式服务框架(HSF、Dubbo)

    > HSF(High-SpeedServiceFramework)是一款面向企业级互联网架构的分布式服务框架，以高性能网络通信框架为基础，提供了诸如服务发布与注册、服务调用、服务路由、服务鉴权、服务限流、服务降级和服务调用链路跟踪等一系列久经考验的功能特性。

  - 分布式配置管理(推送)

    > EDAS 提供高效的分布式配置管理，能够将分布式系统的配置信息在 EDAS 控制台上集中管理起来，做到一处配置，处处使用。更重要的是，EDAS 允许您在控制台上对配置信息进行修改，在秒级时间内就能够实时通知到所有的机器。

  - 分布式任务调度

    > 任务调度服务允许用户配置任意周期性调度的单机或者分布式任务，并能对任务运行周期进行管理，同时提供对任务的历史执行记录进行查询。适用于诸如每天凌晨2点定时迁移历史数据，每隔5分钟进行任务触发，每个月的第一天发送系统月报等任务调度场景。

  - 分布式事务

    > 全局事务服务(GlobalTransactionService，简称 GTS)是一款高性能、高可靠、接入简单的分布式事务中间件，用于解决分布式环境下的事务一致性问题。该产品支持 DRDS、RDS、Oracle、MySQL、PostgreSQL、H2 等多种数据源，并可以配合使用 EDAS、Dubbo 及多种私有 RPC 框架，同时还兼容 MQ 消息队列等中间件产品，能够轻松实现分布式数据库事务、多库事务、消息事务、服务链路级事务及其各种组合，策略丰富，易用性和性能兼顾。

4. 运维管控与服务治理

  - 服务鉴权(HSF)
  - 服务限流(规则: QPS、线程)
  - 服务降级(精准屏蔽劣质服务, 从响应时间维度进行规则配置)
  - 自动化压测(模拟真实环境的线上压测)

5. 立体化监控与数字化运营

  - 分布式链路跟踪(EDAS鹰眼监控系统: 系统调用、消息发送和数据库访问, 目前采样率为50%)
  - 服务调用监控(服务的QPS、响应时间、出错率)
  - IaaS基础监控(机器的CPU、内存、负载、网络、磁盘)

6. 工具支持

  - IDEA插件
  - Eclipse插件
  - 轻量级配置中心(铂金版)

# 产品优势

- 更可靠
- 更全面
- 更深入
- 更开放

# 应用场景

1. 应用发布与管理
2. 构建分布式系统
3. 透过数字来剖析系统运行状态
4. 专有云开发运维系统

# 安装EDASAgent

1. 方式一:<br>
  登录ECS,输入以下命令执行<br>
  `wget -q -O /root/install.sh http://edas-hz.oss-cn-hangzhou-internal.aliyuncs.com/install.sh && sh /root/install.sh` 上述命令默认安装JDK1.8, 如果要使用JDK1.7, 需要加上`-force -java7`参数
2. 方式二:<br>
  从ECS镜像选择包含EDASAgent的镜像进行安装
3. 方式三:<br>
  在EDAS控制台使用"导入ECS"功能为已有ECS安装EDASAgent(会使用EDAS系统镜像格式化磁盘，数据会丢失)

# PICK

- EDAS 中的资源主要是指ECS, SLB, VPC
- 计费维度按照应用部署的节点数来计算。例如：10个应用，共运行在15台机器上，那么15台就是 EDAS 的计费维度

- EDAS 应用

  - 中间件服务化应用(swarm集群): 有中间件需求的场景

    - 普通应用(jar/war)
    - Docker应用

  - Kubernetes 通用应用(Kubernetes集群): 没有中间件需求

- Docker 应用适用于对容器运行环境需要定制（如解密包、本地证书、Java 版本等）

- Kubernetes 应用只支持 VPC 网络

- 发布Docker应用的两种方式:

  - 在Swarm集群中的ECS创建Docker实例并创建EDASContainer,然后上传war包至EDASContainer中
  - 在本地将Docker基础镜像,EDAS基础镜像,war包制作成Docker镜像,然后上传到镜像仓库中并部署

- 发布 Kubernetes 应用：通过 Docker 官方推荐镜像或自定义镜像，将应用部署到VPC的某个集群的一个或多个 Pod 中

- 回滚应用（适用于普通应用和 Docker 应用）：指定回滚版本后，可按分组按批次，自动进行回滚。Kubernetes 应用的回滚则需要重新部署应用，并设定版本即可。

- 应用扩容、缩容：普通应用和 Docker 应用需要人为添加 ECS 或者停止下线 ECS；而 Kubernetes 应用通过设置 Pod 数量由系统在集群内自动完成 Pod 的调整。
- 删除：普通应用和 Docker 应用需要停止应用、下线 ECS 实例后，删除应用；Kubernetes 应用则直接将应用下所有的 Pod、SLB 设备及应用本身全部删除。

- 实例分组管理（适用于普通应用和 Docker 应用）Kubernetes 应用不对具体 Pod 进行管理。

- 普通应用和 Docker 应用在部署后，需要启动服务，并成功后，才能正常使用。

- 普通应用和 Docker 应用包括设置内/外网负载均衡，设置容器、JVM 参数、负载均衡、健康检查及基本信息，以及设置健康检查 URL。

- Kubernetes 应用包括设置内/外网负载均衡和更改规格。

- Kubernetes 应用创建成功后，即可使用，无需启动、停止。

- Tomcat 容器、JVM 参数配置保存后仅改变相关配置文件，不会重启应用，需要应用重启后才会真正生效。

- 一个 ECS 只能部署一个普通应用，却可以部署多个运行在不同的 Docker 容器中的应用。

- 应用发布主要包含以下几个步骤

  - 创建应用
  - 部署应用
  - 配置负载均衡

- 应用监控

  - 豆腐块(默认),多图,表格

- 基础监控

  - 包括 RPC 服务和 HTTP 服务; 数据库访问; CPU、负载、内存、磁盘及网络
  - 由于从数据的采集到分析存在一定的延时，所以 EDAS 无法提供百分之百的实时监控视图，目前的时延策略为2分钟。
  - 统计当前时间之前半个小时内的监控数据，是登录基础监控页面时的默认方式。数据统计点的时间间隔为 1 分钟，是 EDAS 所提供的最细的查询粒度

- 配置推送需要客户端使用SDK监听

- 流量管理规则有两种模式：参数取模和名单分流。

- 流量管理可用于蓝绿部署、A/B 测试以及灰度发布
- 配置扩容规则参数:触发指标，包括 CPU、RT 和 Load。
- 通过在服务提供者端配置限流模块代码，并在 EDAS 中配置限流策略后，使服务提供者具备限流功能,访问请求都会通过限流模块进行计算
- 通过在服务消费者端配置降级模块代码，并在 EDAS 中配置降级策略，使服务消费者具备降级功能。
- EDAS 容器由 AliTomcat，Pandora 和定制的 Pandora 插件组成
- Pandora 是一个轻量级的隔离容器，也就是 taobao-hsf.sar，它用来隔离 Web App 和中间件的依赖，也用来隔离中间件之间的依赖，让其相互之间互不影响。 在 EDAS 的 Pandora 中集成了实现服务发现的插件、实现配置推送的插件、实现调用链跟踪的插件等各种中间件产品插件。利用这些插件可以完成对 EDAS 应用的服务监控、治理、跟踪、分析等全方位运维管理。
- 收敛日志 用于将单个应用中类似格式的日志合并和排序。收敛日志更加精简，易于发现有用的日志，如异常堆栈、error 级别日志。建议选择 Tomcat 的 catalina.out 或 hsf.log 等主要的业务日志配置收敛。
- 由于应用是部署并运行在 Tomcat 容器中，EDAS 提供了容器监控功能----应用诊断，为您提供相应数据来判断内存，类冲突等应用运行问题。
- EDAS 针对应用容器提供了详细的统计功能，可以为开发者提供当前应用运行机器上的 JVM 堆／非堆内存、类加载（Class Loader）、线程、Tomcat 连接器的统计数据。
- 监控对象不一样，基础监控面向的是机器，容器监控面向是应用所在的容器。
- 应用诊断不支持"集群"方式查看诊断信息，仅支持单机查看。
- 基础监控存在一定的时延，容器监控除了内存监控外，其他数据由于不需要后续的统计计算，所以几乎是实时的。
- 调用链详情是为了定位在分布式链路调用过程中的每个环节的耗时和异常，本地方法并不是调用链的核心内容，本地方法的耗时及异常建议通过业务log的方式进行。
- 重启服务器后 EDAS Agent 会自动重启，但是您的 Tomcat 并不会自动重启。
- 目前 EDAS 尚未提供分布式 Session 管理的功能，用户可以借助一些分布式缓存系统（比如：OCS，Redis 等）来进行管理。
- 基础监控可以提供以应用为维度的数据，可以汇总应用所在 ECS 的指标，提供给用户一个聚合结果。同时可以查看单机指标。
- 请参考 日志采集器相关问题，确认是否有访问请求流量，以及 8182 端口是否正常打开。

# 白皮书重点收集

- 企业级分布式应用服务 EDAS 由控制台、数据采集系统、配置注册中心和鉴权中心等 系统组成
- EDAS 控制台包含 2 个组件，EDASConsole(界面) 和 EDASAdmin(后台任务:定时同步 ECS 数据、定时自动扩 缩容等)
- 数据收集系统包含:

  - 采集配置中心(类似ARMS,生成采集任务推送到 ZooKeeper)、
  - JStorm 实时采集节点(任务真正执行的节点，8182端口拉取,分析)、
  - HBase(用于存储实时计算后的各种数据(状态\报警), 目前默认保留 2000 小时)、
  - HiStore(用于存储调用链的详情日志, 目前默认保留 7 天时间)

- Butler 系统是 EDAS 对外输出的主要日常监控及报警工具
